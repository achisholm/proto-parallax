//*****************************************************************************
// Quantity Input Control.
//
//*****************************************************************************

@import "tools.vars";
@import "tools.mixins";

// ============================================================================
// Quantity Input Control.
// ============================================================================

$qty-height-1: 30px;
$qty-height-2: 40px;
$qty-margin: 5px;

.qty {
    // <form> element encompassing UI input field and controls for adding or 
    // editing basket product quantities.
    @include flexbox;
    width: 100%;
    max-width: 140px;
    height: $qty-height-2;
    margin: auto;
    font-size: 14px;
    position: relative;

    @media #{$small} {
        height: $qty-height-1;
    }
    
    &__message-area {
        // .qty__message-area
        // Validation message generated by the validation plugin.
        clear: left;
        
        @media #{$less-than-small} {
            margin-left: 20px;
            margin-right: 20px;
            margin-bottom: 0;
        }
        
        .group & {
            // .group .qty__message-area
            // Provide horizontal space between group's border and message area.
            margin-left: 10px;
            margin-right: 10px;
        }
        
        .group--clearance & {
            // .group--clearance .qty__message-area
            // Provide space between group's border and message area.
            margin-top: 8px;
            margin-left: 20px;
            margin-right: 20px;
            
            @media #{$small} {
                margin-left: 0;
                margin-right: 0;
            }
        }
    }
    
    // ========================================================================
    // Input Field.
    // ========================================================================
    
    &__input {
        // .qty__input
        // Text input field that accepts product quantities as positive integers.
        @include flex(1, 1, 50%);
        @include appearance(none);
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        -webkit-touch-callout: none;
        text-align: center;
        min-width: 0; // overide user-agent default.
        background-color: white;
        border: 2px solid $tlc-blue;
        border-radius: 5px;
        margin-right: $qty-margin;
        padding-left: 0;
        padding-right: 0;
        height: $qty-height-2;
        transition-property: color, border-color;
        transition-duration: 0.2s;
        transition-timing-function: ease;
        
        @media #{$small} {
            height: $qty-height-1;
        }
        
        &:hover {
            // .qty__input:hover
            box-shadow: 0 0 0 2px rgba($tlc-blue, 0.1);
        }
        
        &:focus {
            // .qty__input:focus
            outline: none;
            box-shadow: 0 0 0 3px rgba($tlc-blue, 0.2);
        }
        
        //---------------------------------------------------------------------
        // Invalid.
        // 
        // Applied when server response has rejected the inputted value. Red 
        // border input field.
        //-----
        
        &.invalid {
            // .qty__input.invalid
            border-color: $color-negative;
        }
    }
    
    &__controls {
        // .qty__controls
        // Div wrapper containing 'Add' button, 'Update' button and -/+ 
        // increment buttons.
        @include flexbox;
        @include flex(0, 0, ($qty-height-2 * 2 + $qty-margin));
        
        @media #{$small} {
            @include flex(0, 0, ($qty-height-1 * 2 + $qty-margin));
        }
    }
    
    &__control {
        // Class applied to 'Add' button, 'Update' buttons.
        // .qty__control
        width: 100%;
    }
   
    &__control-update {
        // Div wrapper for 'Update' button (hidden by default).
        // .qty__control-update
        display: none;
    }
    
    &__control-amount {
        // Div wrapper for -/+ increment buttons (hidden by default).
        // .qty__control-amount
        display: none;
    }
    
    
    // ========================================================================
    // 'Add' & 'Update' Buttons.
    // ========================================================================
    
    &__button {
        // .qty__button
        // The <button> elements for 'Add' & 'Update' buttons.
        @include appearance(none);
        @include user-select(none);
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        background-color: $tlc-blue;
        color: white;
        width: 100%;
        height: $qty-height-2;
        border: none;
        border-radius: 5px;
        font-weight: 600;
        position: relative;
        cursor: pointer;
        transition-property: background-color, color;
        transition-duration: 0.2s;
        transition-timing-function: ease;

        @media #{$small} {
            height: $qty-height-1;
        }
        
        &:hover,
        &:focus {
            // .qty__button:hover,
            // .qty__button:focus
            outline: none;
            box-shadow: 0 0 0 3px rgba($tlc-blue, 0.2);
        }
    }
    
    // ========================================================================
    // Increment/Decrement Buttons.
    // ========================================================================

    &__spinner-button {
        // .qty__spinner-button
        // The <button> elements for '-' & '+' buttons.
        @include appearance(none);
        @include user-select(none);
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        background-color: white;
        padding: 0;
        margin: 0;
        width: $qty-height-2;
        height: $qty-height-2;
        font-size: 16px;
        font-weight: bold;
        border-color: $tlc-blue;
        border-style: solid;
        border-width: 2px;
        border-radius: 5px;
        color: $tlc-blue;
        cursor: pointer;
        position: relative;

        @media #{$small} {
            width: $qty-height-1;
            height: $qty-height-1;
        }
        
        &:hover {
            // .qty__spinner-button:hover
            box-shadow: 0 0 0 2px rgba($tlc-blue, 0.1);
        }
        
        &:focus {
            // .qty__spinner-button:focus
            outline: none;
            box-shadow: 0 0 0 2px rgba($tlc-blue, 0.2);
        }
        
        &:first-child {
            // .qty__spinner-button:first-child
            margin-right: $qty-margin;
        }
        
        &.is-loading {
            // .qty__spinner-button.is-loading
            // Applied to button while waiting for server's response. When 
            // clicked, changes increment button to show loading spinner.
            color: transparent;

            &:before {
                // .qty__spinner-button.is-loading:before
                // Animated loading spinner.
                content: "";
                position: absolute;
                display: block;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                box-shadow: 0 0 2px 1px rgba($tlc-blue, 0.1);
                animation: spin 1s linear infinite;
                border-width: 2px;
                border-style: solid;
                border-color: rgba($tlc-blue, 0.5) transparent rgba($tlc-blue, 0.5) rgba($tlc-blue, 0.5);
                top: 0;
                bottom: 0;
                left: 0;
                right: -2px;
                margin: auto;
            }
        }
    }

    &__button-label-mobile {
        // .qty__button-label-mobile
        // Additional ' to Basket' text, added in button only when there is enough room.
        display: inline;

        @media #{$small} {
            display: none;
        }

        @media (max-width: 399px) {
            display: none;
        }
    }
    
    //=========================================================================
    // Form States.
    //=========================================================================
        
    //-------------------------------------------------------------------------
    // Loading.
    //
    // Shows a disabled form with loading spinner while waiting for DOM to 
    // complete fully loading. Applied to the <body> element.
    //-----

    .plugins-loading & {
        // .plugins-loading .qty

        .qty__input {
            // .plugins-loading .qty .qty__input
            border-color: $grey-56;
            color: $grey-80;
        }
        
        .qty__button {
            // .plugins-loading .qty .qty__button
            color: transparent;
            background-color: $grey-67;
            box-shadow: inset 0 0 0px 2px $grey-56;

            &:before {
                // .plugins-loading .qty .qty__button:before
                // Animated loading spinner.
                content: "";
                position: absolute;
                display: block;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                border-width: 2px;
                border-style: solid;
                border-color: white white white transparent;
                top: 0;
                bottom: 0;
                left: 0;
                right: -2px;
                margin: auto;
            }
        }
    }


    //-------------------------------------------------------------------------
    // Validating.
    //
    // Shows a loading spinner while waiting for server's response.
    //-----
    
    &.validating {
        // .qty.validating

        .qty__button {
            // .qty.validating .qty__button
            color: transparent;
            
            &:before {
                // .qty.validating .qty__button:before
                // Animated loading spinner.
                content: "";
                position: absolute;
                display: block;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                box-shadow: 0 0 5px 2px rgba(white, 0.2);
                animation: spin 1s linear infinite;
                border-width: 2px;
                border-style: solid;
                border-color: rgba(white, 0.5)
                              transparent
                              rgba(white, 0.5)
                              rgba(white, 0.5);
                top: 0;
                bottom: 0;
                left: 0;
                right: -2px;
                margin: auto;
            }
        }
    }
    
    //-------------------------------------------------------------------------
    // Valid.
    //
    // Applied when successfully added to basket. Green border input field. 
    //-----
    
    &.is-added {
        // .qty.is-added
        
        .qty__input {
            // .qty.is-added .qty__input
            border-color: $color-positive;
            
            &.invalid {
                // .qty.is-added .qty__input.invalid
                border-color: $color-negative;
            }
        }
        
        .qty__control-add {
            // .qty.is-added .qty__control-add
            display: none;
        }
        
        .qty__control-amount {
            // .qty__control-add .qty__control-amount
            @include flexbox;
        }
    }
    
    //-------------------------------------------------------------------------
    // Dirty & Valid.
    //
    // Applied when added to basket and input value is different to quantity 
    // added.
    //-----
    
    &.is-dirty.is-added {
        // .qty.is-dirty.is-added

        .qty__control-add,
        .qty__control-amount {
            // .qty.is-dirty.is-added .qty__control-add,
            // .qty.is-dirty.is-added .qty__control-amount
            display: none;
        }
        
        .qty__control-update {
            // .qty.is-dirty.is-added .qty__control-update
            display: block;
        }
    }
}